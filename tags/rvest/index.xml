<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Rvest on Ítalo Cegatta</title>
    <link>/tags/rvest/index.xml</link>
    <description>Recent content in Rvest on Ítalo Cegatta</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <atom:link href="/tags/rvest/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Web scraping: dados de páginas da internet na palma da sua mão</title>
      <link>/web-scraping-dados-de-paginas-da-internet-na-palma-da-sua-mao/</link>
      <pubDate>Fri, 16 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>/web-scraping-dados-de-paginas-da-internet-na-palma-da-sua-mao/</guid>
      <description>&lt;p&gt;Você já precisou copiar na mão uma informação de texto, valor ou tabela de uma pagina web? Pelo menos no meu trabalho isto é muito comum. Por mais que os dados estejam lá site, eles nunca estão disponíveis todos juntos e no formato que queremos, parece que sacanagem. Diante disto, o objetivo deste post é mostrar como podemos utilizar o R para coletar dados de uma página web e esquecer o famooooso &lt;em&gt;ctrl+c/ctrl+v&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Vamos exemplificar o post utilizando o site do IBGE para saber quantos metros cúbicos de lenha de eucalipto foram produzidos em 2015 em cada estado brasileiro. De cara, se os dados não estiverem numa tabela pronta, você já espera ter que entrar em 27 páginas diferentes para pegar esta informação.&lt;/p&gt;
&lt;p&gt;Nosso ponto de partida é a página &lt;a href=&#34;http://www.ibge.gov.br/estadosat/&#34;&gt;States@&lt;/a&gt; do IBGE, que reúne diversas informações na escala estadual. Acessando a página podemos ver o código html por trás (utilize a tecla F12) e assim entender como a página está estruturada. Como queremos entrar nos Estados, podemos ver na Figura &lt;a href=&#34;#fig:pg1&#34;&gt;1&lt;/a&gt; que essa informação está abaixo do &lt;code&gt;id=&amp;quot;menu&amp;quot;&lt;/code&gt;. Note que ao passarmos o mouse sobre a linha &lt;code&gt;&amp;lt;div id=&amp;quot;menu&amp;quot;&amp;gt;&lt;/code&gt; o navegador identifica na página a localização do elemento e ainda nos informa o id CSS de rastreio, no caso &lt;code&gt;div#menu&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:pg1&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;http://i.imgur.com/VjiEvCM.png&#34; alt=&#34;Página inicial do site.&#34;  /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figura  1: Página inicial do site.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Então já podemos começar a programar e desenhar o acesso aos dados. No R, cada página web é um objeto que precisa ser salvo na memória. Então, cada página é importante para ter os dados ou por ser uma etapa para conseguir os dados. A página inicial (&lt;code&gt;pg_raiz&lt;/code&gt;) contém os links para as páginas dos Estados, por isso precisamos acessá-la.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(&amp;quot;pacman&amp;quot;)) install.packages(&amp;quot;pacman&amp;quot;)
pacman::p_load(purrr, dplyr, tidyr, stringr, rvest, ggplot2, viridis, scales, sf)
pacman::p_load_gh(&amp;quot;italocegatta/brmap&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;url_raiz &amp;lt;- &amp;quot;http://www.ibge.gov.br/estadosat/&amp;quot;

pg_raiz &amp;lt;- read_html(url_raiz)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;No objeto &lt;code&gt;posfixo_estados&lt;/code&gt; temos a parte do link que leva até a página de cada estado. Para ter o link completo, é só juntar com o link da página raiz.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;posfixo_estados &amp;lt;- html_node(pg_raiz, &amp;quot;div#menu&amp;quot;) %&amp;gt;% 
  html_children() %&amp;gt;%
  html_node(&amp;quot;a&amp;quot;) %&amp;gt;% 
  html_attr(&amp;quot;href&amp;quot;)

posfixo_estados&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;perfil.php?sigla=ro&amp;quot; &amp;quot;perfil.php?sigla=ac&amp;quot; &amp;quot;perfil.php?sigla=am&amp;quot;
##  [4] &amp;quot;perfil.php?sigla=rr&amp;quot; &amp;quot;perfil.php?sigla=pa&amp;quot; &amp;quot;perfil.php?sigla=ap&amp;quot;
##  [7] &amp;quot;perfil.php?sigla=to&amp;quot; &amp;quot;perfil.php?sigla=ma&amp;quot; &amp;quot;perfil.php?sigla=pi&amp;quot;
## [10] &amp;quot;perfil.php?sigla=ce&amp;quot; &amp;quot;perfil.php?sigla=rn&amp;quot; &amp;quot;perfil.php?sigla=pb&amp;quot;
## [13] &amp;quot;perfil.php?sigla=pe&amp;quot; &amp;quot;perfil.php?sigla=al&amp;quot; &amp;quot;perfil.php?sigla=se&amp;quot;
## [16] &amp;quot;perfil.php?sigla=ba&amp;quot; &amp;quot;perfil.php?sigla=mg&amp;quot; &amp;quot;perfil.php?sigla=es&amp;quot;
## [19] &amp;quot;perfil.php?sigla=rj&amp;quot; &amp;quot;perfil.php?sigla=sp&amp;quot; &amp;quot;perfil.php?sigla=pr&amp;quot;
## [22] &amp;quot;perfil.php?sigla=sc&amp;quot; &amp;quot;perfil.php?sigla=rs&amp;quot; &amp;quot;perfil.php?sigla=ms&amp;quot;
## [25] &amp;quot;perfil.php?sigla=mt&amp;quot; &amp;quot;perfil.php?sigla=go&amp;quot; &amp;quot;perfil.php?sigla=df&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;url_estados &amp;lt;- paste0(url_raiz, posfixo_estados)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos agora acessar às páginas de todos os Estados e armazenar no objeto &lt;code&gt;pg_estados&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;pg_estados &amp;lt;- map(url_estados, read_html)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Navegando pela página de um estado qualquer, identificamos que queremos a informação contida no link &lt;em&gt;Extração Vegetal e Silvicultura 2015&lt;/em&gt;. Nesse caso, precisamos mais uma vez dos links que leva a esta página (para cada estado). Também é possível, tanto pelo R quanto pelo navegador, ver que esse link está na posição 68 da lista/tablela nomeada como &lt;code&gt;table.temas&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;posfixo_lenha &amp;lt;- map(
  pg_estados,
  ~html_node(.x, &amp;quot;table.temas&amp;quot;) %&amp;gt;% 
    html_children() %&amp;gt;%
    &amp;#39;[&amp;#39;(68) %&amp;gt;%
    html_node(&amp;quot;a&amp;quot;) %&amp;gt;% 
    html_attr(&amp;quot;href&amp;quot;)
  ) %&amp;gt;% 
  flatten_chr()

posfixo_lenha&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;temas.php?sigla=ro&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [2] &amp;quot;temas.php?sigla=ac&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [3] &amp;quot;temas.php?sigla=am&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [4] &amp;quot;temas.php?sigla=rr&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [5] &amp;quot;temas.php?sigla=pa&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [6] &amp;quot;temas.php?sigla=ap&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [7] &amp;quot;temas.php?sigla=to&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [8] &amp;quot;temas.php?sigla=ma&amp;amp;tema=extracaovegetal2015&amp;quot;
##  [9] &amp;quot;temas.php?sigla=pi&amp;amp;tema=extracaovegetal2015&amp;quot;
## [10] &amp;quot;temas.php?sigla=ce&amp;amp;tema=extracaovegetal2015&amp;quot;
## [11] &amp;quot;temas.php?sigla=rn&amp;amp;tema=extracaovegetal2015&amp;quot;
## [12] &amp;quot;temas.php?sigla=pb&amp;amp;tema=extracaovegetal2015&amp;quot;
## [13] &amp;quot;temas.php?sigla=pe&amp;amp;tema=extracaovegetal2015&amp;quot;
## [14] &amp;quot;temas.php?sigla=al&amp;amp;tema=extracaovegetal2015&amp;quot;
## [15] &amp;quot;temas.php?sigla=se&amp;amp;tema=extracaovegetal2015&amp;quot;
## [16] &amp;quot;temas.php?sigla=ba&amp;amp;tema=extracaovegetal2015&amp;quot;
## [17] &amp;quot;temas.php?sigla=mg&amp;amp;tema=extracaovegetal2015&amp;quot;
## [18] &amp;quot;temas.php?sigla=es&amp;amp;tema=extracaovegetal2015&amp;quot;
## [19] &amp;quot;temas.php?sigla=rj&amp;amp;tema=extracaovegetal2015&amp;quot;
## [20] &amp;quot;temas.php?sigla=sp&amp;amp;tema=extracaovegetal2015&amp;quot;
## [21] &amp;quot;temas.php?sigla=pr&amp;amp;tema=extracaovegetal2015&amp;quot;
## [22] &amp;quot;temas.php?sigla=sc&amp;amp;tema=extracaovegetal2015&amp;quot;
## [23] &amp;quot;temas.php?sigla=rs&amp;amp;tema=extracaovegetal2015&amp;quot;
## [24] &amp;quot;temas.php?sigla=ms&amp;amp;tema=extracaovegetal2015&amp;quot;
## [25] &amp;quot;temas.php?sigla=mt&amp;amp;tema=extracaovegetal2015&amp;quot;
## [26] &amp;quot;temas.php?sigla=go&amp;amp;tema=extracaovegetal2015&amp;quot;
## [27] &amp;quot;temas.php?sigla=df&amp;amp;tema=extracaovegetal2015&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Aqui, mais uma vez, será preciso juntar o &lt;em&gt;link&lt;/em&gt; específico de cada estado com a url da página raiz.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;url_lenha &amp;lt;- paste0(url_raiz, posfixo_lenha)

pg_lenha &amp;lt;- map(url_lenha, read_html)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Agora, vamos dar um passo para trás e listar o nome dos Estados na ordem que as páginas são acessadas para podemos utilizar mais à frente.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lista_estados &amp;lt;- html_node(pg_raiz, &amp;quot;div#menu&amp;quot;) %&amp;gt;% 
  html_children() %&amp;gt;%
  html_node(&amp;quot;img&amp;quot;) %&amp;gt;%
  html_attr(&amp;quot;alt&amp;quot;)

lista_estados&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;Rondônia&amp;quot;            &amp;quot;Acre&amp;quot;                &amp;quot;Amazonas&amp;quot;           
##  [4] &amp;quot;Roraima&amp;quot;             &amp;quot;Pará&amp;quot;                &amp;quot;Amapá&amp;quot;              
##  [7] &amp;quot;Tocantins&amp;quot;           &amp;quot;Maranhão&amp;quot;            &amp;quot;Piauí&amp;quot;              
## [10] &amp;quot;Ceará&amp;quot;               &amp;quot;Rio Grande do Norte&amp;quot; &amp;quot;Paraíba&amp;quot;            
## [13] &amp;quot;Pernambuco&amp;quot;          &amp;quot;Alagoas&amp;quot;             &amp;quot;Sergipe&amp;quot;            
## [16] &amp;quot;Bahia&amp;quot;               &amp;quot;Minas Gerais&amp;quot;        &amp;quot;Espírito Santo&amp;quot;     
## [19] &amp;quot;Rio de Janeiro&amp;quot;      &amp;quot;São Paulo&amp;quot;           &amp;quot;Paraná&amp;quot;             
## [22] &amp;quot;Santa Catarina&amp;quot;      &amp;quot;Rio Grande do Sul&amp;quot;   &amp;quot;Mato Grosso do Sul&amp;quot; 
## [25] &amp;quot;Mato Grosso&amp;quot;         &amp;quot;Goiás&amp;quot;               &amp;quot;Distrito federal&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O próximo passo é extrair a tabela de informação de cada estado e posteriormente filtrar a informação que é de nosso interesse. Note que é neste momento que a programação se diferencia das atividades manuais: caso seu interesse seja por lenha de pinus, por exemplo, basta alterar uma palavra no código abaixo e ser feliz com o resultado em poucos segundos. Claro que é um exemplo hipotético, dificilmente alguém vai precisar desse código específico, mas o ponto está na capacidade de escrever seu próprio código e não precisar fazer o trabalho manual.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tabelas &amp;lt;- map(
  set_names(pg_lenha, lista_estados), 
  ~html_node(.x, &amp;quot;table#tabela_temas&amp;quot;) %&amp;gt;% 
  html_table() %&amp;gt;% 
  as_tibble() %&amp;gt;% 
  rename(produto = X1, valor = X2, unidade = X3)
  )

qnt &amp;lt;- map_df(
  tabelas, 
  ~filter(.x, str_detect(produto, c(&amp;quot;Lenha de eucalipto&amp;quot;, &amp;quot;quantidade&amp;quot;))) %&amp;gt;% 
  &amp;#39;[[&amp;#39;(&amp;quot;valor&amp;quot;) 
  ) %&amp;gt;%
  gather(estado, volume) %&amp;gt;% 
  mutate(volume = as.numeric(str_replace_all(volume, &amp;quot;\\.&amp;quot;, &amp;quot;&amp;quot;)))

qnt &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 27 x 2
##       estado volume
##        &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt;
##  1  Rondônia    690
##  2      Acre     NA
##  3  Amazonas     NA
##  4   Roraima     NA
##  5      Pará     NA
##  6     Amapá     NA
##  7 Tocantins   2300
##  8  Maranhão 195428
##  9     Piauí 188724
## 10     Ceará     NA
## # ... with 17 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De certa forma já resolvemos o problema, a quantidade de lenha de eucalipto produzida em cada estado no ano de 2015 já está em nossas mãos. Mas vamos dar um passo além e visualizar isso num mapa. O pacote &lt;a href=&#34;https://github.com/italocegatta/brmap&#34;&gt;brmap&lt;/a&gt; possui os polígonos dos Estados brasileiros no formato &lt;code&gt;sf&lt;/code&gt;, o novo pacote para manupulação de objetos espaciais no R.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;qnt_mapa &amp;lt;- left_join(brmap_estado, qnt)

ggplot(qnt_mapa) +
  geom_sf(aes(fill = volume)) +
  labs(
    title = &amp;quot;Lenha de eucalipto - quantidade produzida em 2015&amp;quot;,
    subtitle = &amp;quot;IBGE Estados - Extração Vegetal e Silvicultura 2015&amp;quot;
  ) +
  scale_fill_viridis(
    Lenha~de~eucalipto~(m^3), 
    na.value = &amp;quot;grey90&amp;quot;,
    labels = function(x) format(x, big.mark = &amp;quot;.&amp;quot;, decimal.mark = &amp;quot;,&amp;quot;, scientific = FALSE)
  ) +
  theme_bw() +
  theme(legend.position = &amp;quot;bottom&amp;quot;) +
  guides(fill = guide_colorbar(barwidth = 30, title.position = &amp;quot;top&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-16-web-scraping-dados-de-paginas-da-internet-na-palma-da-sua-mao_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;4000&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Caso tenha alguma dúvida ou sugestão sobre o post, fique à vontade para fazer um comentário ou me contactar por Email.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;devtools::session_info()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Portuguese_Brazil.1252      
##  tz       America/Sao_Paulo           
##  date     2017-07-08                  
## 
##  package     * version    date       source                            
##  assertthat    0.2.0      2017-04-11 CRAN (R 3.3.3)                    
##  backports     1.1.0      2017-05-22 CRAN (R 3.3.3)                    
##  base        * 3.3.3      2017-03-06 local                             
##  bindr         0.1        2016-11-13 CRAN (R 3.3.3)                    
##  bindrcpp    * 0.2        2017-06-17 CRAN (R 3.3.3)                    
##  blogdown      0.0.25     2017-03-23 Github (rstudio/blogdown@1c10d16) 
##  bookdown      0.4        2017-05-20 CRAN (R 3.3.3)                    
##  brmap       * 0.0.2      2017-07-07 local                             
##  colorspace    1.3-2      2016-12-14 CRAN (R 3.3.2)                    
##  curl          2.7        2017-06-26 CRAN (R 3.3.3)                    
##  datasets    * 3.3.3      2017-03-06 local                             
##  DBI           0.7        2017-06-18 CRAN (R 3.3.3)                    
##  devtools      1.13.2     2017-06-02 CRAN (R 3.3.3)                    
##  digest        0.6.12     2017-01-27 CRAN (R 3.3.2)                    
##  dplyr       * 0.7.1      2017-06-22 CRAN (R 3.3.3)                    
##  evaluate      0.10       2016-10-11 CRAN (R 3.3.3)                    
##  ggplot2     * 2.2.1.9000 2017-06-16 Github (tidyverse/ggplot2@398fc07)
##  glue          1.1.1      2017-06-21 CRAN (R 3.3.3)                    
##  graphics    * 3.3.3      2017-03-06 local                             
##  grDevices   * 3.3.3      2017-03-06 local                             
##  grid          3.3.3      2017-03-06 local                             
##  gridExtra     2.2.1      2016-02-29 CRAN (R 3.3.3)                    
##  gtable        0.2.0      2016-02-26 CRAN (R 3.3.2)                    
##  highr         0.6        2016-05-09 CRAN (R 3.3.3)                    
##  htmltools     0.3.6      2017-04-28 CRAN (R 3.3.3)                    
##  httr          1.2.1      2016-07-03 CRAN (R 3.3.2)                    
##  knitr         1.16       2017-05-18 CRAN (R 3.3.3)                    
##  labeling      0.3        2014-08-23 CRAN (R 3.3.2)                    
##  lazyeval      0.2.0      2016-06-12 CRAN (R 3.3.2)                    
##  magrittr      1.5        2014-11-22 CRAN (R 3.3.2)                    
##  memoise       1.1.0      2017-04-21 CRAN (R 3.3.3)                    
##  methods       3.3.3      2017-03-06 local                             
##  munsell       0.4.3      2016-02-13 CRAN (R 3.3.2)                    
##  pacman      * 0.4.6      2017-05-14 CRAN (R 3.3.3)                    
##  pkgconfig     2.0.1      2017-03-21 CRAN (R 3.3.3)                    
##  plyr          1.8.4      2016-06-08 CRAN (R 3.3.2)                    
##  purrr       * 0.2.2.2    2017-05-11 CRAN (R 3.3.3)                    
##  R6            2.2.2      2017-06-17 CRAN (R 3.3.3)                    
##  Rcpp          0.12.11    2017-05-22 CRAN (R 3.3.3)                    
##  rlang         0.1.1      2017-05-18 CRAN (R 3.3.3)                    
##  rmarkdown     1.6        2017-06-15 CRAN (R 3.3.3)                    
##  rprojroot     1.2        2017-01-16 CRAN (R 3.3.3)                    
##  rvest       * 0.3.2      2016-06-17 CRAN (R 3.3.2)                    
##  scales      * 0.4.1      2016-11-09 CRAN (R 3.3.2)                    
##  selectr       0.3-1      2016-12-19 CRAN (R 3.3.2)                    
##  sf          * 0.5-1      2017-06-23 CRAN (R 3.3.3)                    
##  stats       * 3.3.3      2017-03-06 local                             
##  stringi       1.1.5      2017-04-07 CRAN (R 3.3.3)                    
##  stringr     * 1.2.0      2017-02-18 CRAN (R 3.3.2)                    
##  tibble        1.3.3      2017-05-28 CRAN (R 3.3.3)                    
##  tidyr       * 0.6.3      2017-05-15 CRAN (R 3.3.3)                    
##  tools         3.3.3      2017-03-06 local                             
##  udunits2      0.13       2016-11-17 CRAN (R 3.3.2)                    
##  units         0.4-5      2017-06-15 CRAN (R 3.3.3)                    
##  utils       * 3.3.3      2017-03-06 local                             
##  viridis     * 0.4.0      2017-03-27 CRAN (R 3.3.3)                    
##  viridisLite * 0.2.0      2017-03-24 CRAN (R 3.3.3)                    
##  withr         1.0.2      2016-06-20 CRAN (R 3.3.3)                    
##  XML           3.98-1.9   2017-06-19 CRAN (R 3.3.3)                    
##  xml2        * 1.1.1      2017-01-24 CRAN (R 3.3.2)                    
##  yaml          2.1.14     2016-11-12 CRAN (R 3.3.3)&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Download automático de imagens MODIS</title>
      <link>/download-automatico-de-imagens-modis/</link>
      <pubDate>Sun, 15 Jan 2017 00:00:00 +0000</pubDate>
      
      <guid>/download-automatico-de-imagens-modis/</guid>
      <description>&lt;!-- BLOGDOWN-HEAD --&gt;
&lt;!-- /BLOGDOWN-HEAD --&gt;

&lt;!-- BLOGDOWN-BODY-BEFORE --&gt;
&lt;!-- /BLOGDOWN-BODY-BEFORE --&gt;
&lt;p&gt;O MODIS (MODerate resolution Imaging Spectroradiometer) faz parte de um programa da NASA para monitoramento da superfície terrestre. Os satélites Terra e Aqua fornecem informações muito interessantes para o setor agroflorestal e nos permite entender de maneira bastante eficaz a dinâmica do uso do solo e de crescimento das nossas culturas.&lt;/p&gt;
&lt;p&gt;O MODOIS tem diversos &lt;a href=&#34;https://modis.gsfc.nasa.gov/data/&#34;&gt;produtos&lt;/a&gt;, mas neste post vamos tratar especificamente do produto &lt;a href=&#34;https://lpdaac.usgs.gov/dataset_discovery/modis/modis_products_table/mod13q1_v006&#34;&gt;MOD13Q1&lt;/a&gt;, que disponibiliza a cada 16 dias um raster de EVI e NDVI com resolução de 250 m. Bom, se você está acostumado com imagens de satélite/drone/vant com resolução submétrica, pode ser que no primeiro momento esta escala te assuste. Mas vale lembrar que é um serviço gratuito e e de ótima qualidade.&lt;/p&gt;
&lt;p&gt;As cenas do MODIS ficam disponíveis em um &lt;a href=&#34;https://e4ftl01.cr.usgs.gov/&#34;&gt;ftp&lt;/a&gt; e navegando por lá podemos chegar na pasta do produto que nos &lt;a href=&#34;http://e4ftl01.cr.usgs.gov/MOLT/MOD13Q1.006&#34;&gt;interessa&lt;/a&gt;. Temos então imagens de satélite processadas, com correção atmosférica, sem deslocamento espacial e com regularidade. O satélite varre a terra a cada dois dias e as melhores visadas são utilizadas para compor o produto que é disponibilizado a cada 16 dias. Há casos (de baixa frequência) em que a nebulosidade é tanta que não é possível compor a informação do pixel dentro desta janela&lt;/p&gt;
&lt;p&gt;Nosso objetivo para este poste é fazer o download das cenas de forma automática, um web scraping. No R há diversos pacotes que nos auxiliam neste processo. A primeira etapa é acessar o ftp que contém as cenas e extrair as datas das cenas disponíveis.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(&amp;quot;pacman&amp;quot;)) install.packages(&amp;quot;pacman&amp;quot;)
pacman::p_load(dplyr, xml2, rvest, httr, stringr, methods)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# url do ftp que contém as cenas
path_root &amp;lt;- &amp;quot;http://e4ftl01.cr.usgs.gov/MOLT/MOD13Q1.006&amp;quot;

# carrega a raiz do ftp
page_root &amp;lt;- read_html(path_root)

# extrai os dias das cenas
scene_days &amp;lt;- page_root %&amp;gt;% 
 html_nodes(&amp;quot;a&amp;quot;) %&amp;gt;% 
  html_text(trim = T) %&amp;gt;%
  &amp;#39;[&amp;#39;(-c(1:7)) %&amp;gt;%
  str_replace_all(&amp;quot;\\/&amp;quot;, &amp;quot;&amp;quot;)

glimpse(scene_days)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  chr [1:395] &amp;quot;2000.02.18&amp;quot; &amp;quot;2000.03.05&amp;quot; &amp;quot;2000.03.21&amp;quot; ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Muito bem, temos até a data da ultima atualização deste post 395 cenas disponíveis. O script abaixo cria a pasta com a data da cena e coloca lá os &lt;a href=&#34;https://modis-land.gsfc.nasa.gov/MODLAND_grid.html&#34;&gt;tiles&lt;/a&gt; de seu interesse. Como exemplo vamos pegar os tiles que cobrem os estados de São Paulo e Bahia. Note que é preciso ter um cadastro para autorizar o download dos arquivos. É simples e rápido de fazer acessando este &lt;a href=&#34;https://urs.earthdata.nasa.gov/users/new/&#34;&gt;link&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# inicio do 1º loop - dias
for (i in seq_along(scene_days)) {
  # cria a pasta para receber os tiles
  if(!dir.exists(scene_days[i])) dir.create(scene_days[i])

  # ideintificador de iteração
  day &amp;lt;- scene_days[i]
  
  # carrega a pagina do dia da cena
  page_tiles &amp;lt;- read_html(paste(path_root, day, sep = &amp;quot;/&amp;quot;))
  
  # extrai os tiles de interesse
  path_tiles &amp;lt;- page_tiles %&amp;gt;% 
    html_nodes(&amp;quot;a&amp;quot;) %&amp;gt;% 
    html_text(trim = T) %&amp;gt;%
    &amp;#39;[&amp;#39;(str_detect(., &amp;quot;[hdf]$&amp;quot;)) %&amp;gt;% 
    &amp;#39;[&amp;#39;(str_detect(., &amp;quot;h13v11|h14v10&amp;quot;))
  
  # inicio do 2º loop - tiles
  for (j in seq_along(path_tiles)) {
    # url do tile
    path_tile &amp;lt;- paste(path_root, day, path_tiles[j], sep = &amp;quot;/&amp;quot;)

    # id do tile
    tile &amp;lt;- paste(day, path_tiles[j], sep = &amp;quot;/&amp;quot;)
    
    # download do arquivo
    if (!file.exists(tile)) {
      temp &amp;lt;- GET(path_tile, authenticate(&amp;quot;LOGIN&amp;quot;, &amp;quot;SENHA&amp;quot;))
      writeBin(content(temp, &amp;quot;raw&amp;quot;), tile)
      rm(temp)
    }
  }
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como tudo que está neste blog, este script foi escrito para resolver um problema específico e com certeza tem muito espaço para melhoria. Os próximos passos da análise, extração dos rasters e processamento da imagem serão abordados em posts separados. No futuro, caso exista uma demanda, pode ser que as funções sejam reunidas em um pacote específico sobre isso.&lt;/p&gt;
&lt;p&gt;Caso tenha alguma dúvida ou sugestão sobre o post, fique à vontade para fazer um comentário ou me contactar por Email.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;devtools::session_info()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Portuguese_Brazil.1252      
##  tz       America/Sao_Paulo           
##  date     2017-04-30                  
## 
##  package    * version  date       source                           
##  assertthat   0.2.0    2017-04-11 CRAN (R 3.3.3)                   
##  backports    1.0.5    2017-01-18 CRAN (R 3.3.2)                   
##  blogdown     0.0.25   2017-03-23 Github (rstudio/blogdown@1c10d16)
##  bookdown     0.3.14   2017-03-23 Github (rstudio/bookdown@f427fdf)
##  curl         2.6      2017-04-27 CRAN (R 3.3.3)                   
##  DBI          0.6-1    2017-04-01 CRAN (R 3.3.3)                   
##  devtools     1.12.0   2016-06-24 CRAN (R 3.3.3)                   
##  digest       0.6.12   2017-01-27 CRAN (R 3.3.2)                   
##  dplyr      * 0.5.0    2016-06-24 CRAN (R 3.3.2)                   
##  evaluate     0.10     2016-10-11 CRAN (R 3.3.3)                   
##  htmltools    0.3.6    2017-04-28 CRAN (R 3.3.3)                   
##  httr       * 1.2.1    2016-07-03 CRAN (R 3.3.2)                   
##  knitr        1.15.1   2016-11-22 CRAN (R 3.3.3)                   
##  magrittr     1.5      2014-11-22 CRAN (R 3.3.2)                   
##  memoise      1.1.0    2017-04-21 CRAN (R 3.3.3)                   
##  pacman     * 0.4.1    2016-03-30 CRAN (R 3.3.3)                   
##  R6           2.2.0    2016-10-05 CRAN (R 3.3.2)                   
##  Rcpp         0.12.10  2017-03-19 CRAN (R 3.3.3)                   
##  rmarkdown    1.5      2017-04-26 CRAN (R 3.3.3)                   
##  rprojroot    1.2      2017-01-16 CRAN (R 3.3.3)                   
##  rvest      * 0.3.2    2016-06-17 CRAN (R 3.3.2)                   
##  selectr      0.3-1    2016-12-19 CRAN (R 3.3.2)                   
##  stringi      1.1.5    2017-04-07 CRAN (R 3.3.3)                   
##  stringr    * 1.2.0    2017-02-18 CRAN (R 3.3.2)                   
##  tibble       1.3.0    2017-04-01 CRAN (R 3.3.3)                   
##  withr        1.0.2    2016-06-20 CRAN (R 3.3.3)                   
##  XML          3.98-1.6 2017-03-30 CRAN (R 3.3.3)                   
##  xml2       * 1.1.1    2017-01-24 CRAN (R 3.3.2)                   
##  yaml         2.1.14   2016-11-12 CRAN (R 3.3.3)&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>