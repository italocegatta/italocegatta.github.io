<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Gganimate on Ítalo Cegatta</title>
    <link>/tags/gganimate/index.xml</link>
    <description>Recent content in Gganimate on Ítalo Cegatta</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <atom:link href="/tags/gganimate/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Gráficos com dimensão espacial e temporal</title>
      <link>/graficos-com-dimensao-espacial-e-temporal/</link>
      <pubDate>Fri, 16 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>/graficos-com-dimensao-espacial-e-temporal/</guid>
      <description>&lt;p&gt;O post de hoje é sobre visualização de dados com dimensão espacial e temporal. Basicamente são gráficos que tem uma informação geográfica associada com informações que variam no tempo. Esse tipo de análise é comum no meu dia a dia e por isso resolvi deixar 3 alternativas resgistradas aqui. O contexto que iremos abordar está relacionado ao banco de dados de focos de incêndios registrados pelo INPE no &lt;a href=&#34;http://www.inpe.br/queimadas/situacao-atual&#34;&gt;Programa Queimadas Monitoramento por Satélites&lt;/a&gt;. O site é bem interessante e apresenta algumas estatísticas úteis sobre as queimadas na América do Sul e Brasil. Iremos trabalhar com a tabela que resume os focos de incêndios por ano e Estado brasileiro.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(&amp;quot;pacman&amp;quot;)) install.packages(&amp;quot;pacman&amp;quot;)
pacman::p_load(readr, dplyr, sf, ggplot2, ggthemes, geofacet, gganimate, viridis, scales)
pacman::p_load_gh(&amp;quot;italocegatta/brmap&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;O primeiro passo foi copiar os dados da página e organizá-los no formato &lt;a href=&#34;https://italocegatta.github.io/o-conceito-tidy-data/&#34;&gt;tidy&lt;/a&gt;. Poderíamos fazer uma análise exploratória dos dados, mas quero manter o foco em algo bem pontual: como mostrar os dados brutos de uma só vez? Ou seja, considerando a dimensão de tempo (ano), geografia (localização do estado) e variável resposta (focos) na mesma janela gráfica, de que forma poderíamos apresentar os dados? .&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;focos &amp;lt;- read_csv2(&amp;quot;https://raw.githubusercontent.com/italocegatta/italocegatta.github.io_source/master/content/dados/base_incendios.csv&amp;quot;)

focos
#&amp;gt; # A tibble: 162 x 3
#&amp;gt;    sigla   ano focos
#&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;
#&amp;gt;  1    AC  2011    13
#&amp;gt;  2    AL  2011   127
#&amp;gt;  3    AM  2011   159
#&amp;gt;  4    AP  2011     5
#&amp;gt;  5    BA  2011   883
#&amp;gt;  6    CE  2011    44
#&amp;gt;  7    DF  2011     8
#&amp;gt;  8    ES  2011    55
#&amp;gt;  9    GO  2011   492
#&amp;gt; 10    MA  2011   656
#&amp;gt; # ... with 152 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos agora adicionar a referência espacial aos dados utilizando os polígonos do pacote &lt;a href=&#34;https://github.com/italocegatta/brmap&#34;&gt;brmap&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;estados_focos &amp;lt;-  focos %&amp;gt;% 
  left_join(brmap_estado, by = &amp;quot;sigla&amp;quot;)

estados_focos
#&amp;gt; # A tibble: 162 x 6
#&amp;gt;    sigla   ano focos cod_estado           estado          geometry
#&amp;gt;    &amp;lt;chr&amp;gt; &amp;lt;int&amp;gt; &amp;lt;int&amp;gt;      &amp;lt;dbl&amp;gt;            &amp;lt;chr&amp;gt;  &amp;lt;simple_feature&amp;gt;
#&amp;gt;  1    AC  2011    13         12             Acre &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  2    AL  2011   127         27          Alagoas &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  3    AM  2011   159         13         Amazonas &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  4    AP  2011     5         16            Amapá &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  5    BA  2011   883         29            Bahia &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  6    CE  2011    44         23            Ceará &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  7    DF  2011     8         53 Distrito Federal &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  8    ES  2011    55         32   Espírito Santo &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt;  9    GO  2011   492         52            Goiás &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt; 10    MA  2011   656         21         Maranhão &amp;lt;MULTIPOLYGON...&amp;gt;
#&amp;gt; # ... with 152 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A primeira abordagem vai utilizar o pacote &lt;a href=&#34;https://github.com/hafen/geofacet&#34;&gt;geofacet&lt;/a&gt;. Ele permite criarmos um grid de referência para orientar a função &lt;code&gt;facet_wrap&lt;/code&gt; de &lt;code&gt;ggplot2&lt;/code&gt;. O pacote já vem carregado com um grid do Brasil, o &lt;code&gt;br_grid1&lt;/code&gt;, mas você pode construir e utilizar seu próprio grid. Eu, particularmente, gosto desta representação pois é extramamente flexível e conporta uma infinidade de gráficos (linhas, pontos, barras…) e dimenções (color, shape, size…). O gráfico &lt;a href=&#34;#fig:focos-geofacet&#34;&gt;1&lt;/a&gt; está bem simples mas cumpre seu papel em facilitar a parcepção da variação anual e dar uma noção da região espacial do estado no Brasil.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(estados_focos, aes(ano, focos)) +
  geom_line() +
  facet_geo(~estado, grid = br_grid1) +
  labs(
    x = &amp;quot;Ano&amp;quot;,
    y = &amp;quot;Nº de focos de incêndios&amp;quot;
  ) +
  scale_x_continuous(breaks = 2011:2017, labels = 11:17) +
  scale_y_continuous(label = unit_format(unit = &amp;quot;k&amp;quot;, scale = 1e-3)) +
  theme_few()&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:focos-geofacet&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-07-08-graficos-com-dimensao-espacial-e-temporal_files/figure-html/focos-geofacet-1.png&#34; alt=&#34;Representação em painel orientado utilizando linhas.&#34; width=&#34;4000&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figura  1: Representação em painel orientado utilizando linhas.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;A segunda abordagem é relativamente simples e intuitiva. Construiremos um mapa temático utilizando o Nº de focos como escala de cor, mas organizado em um painel que tem como base o ano de regsitro. O gráfico &lt;a href=&#34;#fig:focos-facet&#34;&gt;2&lt;/a&gt; apela para a dimensão de cor e instantaneamente nos informa o estado mais crítico. Especificamente para esta análise ele este tipo de gráfico é muito apropriado.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(estados_focos) +
  geom_sf(aes(fill = focos), color = NA) +
  facet_wrap(~ano) +
  labs(fill = &amp;quot;Nº de focos de incêndios&amp;quot;) +
  scale_fill_viridis(label = unit_format(unit = &amp;quot;k&amp;quot;, scale = 1e-3)) +
  theme_bw() +
  theme(legend.position = &amp;quot;bottom&amp;quot;, legend.justification = &amp;quot;right&amp;quot;) +
  guides(fill = guide_colorbar(barwidth = 15, title.position = &amp;quot;top&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:focos-facet&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2017-07-08-graficos-com-dimensao-espacial-e-temporal_files/figure-html/focos-facet-1.png&#34; alt=&#34;Representação em painel utilizando cores.&#34; width=&#34;4000&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figura  2: Representação em painel utilizando cores.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;E por fim, nossa terceira tentativa vai unificar os paineis do gráfico &lt;a href=&#34;#fig:focos-facet&#34;&gt;2&lt;/a&gt; em um gif animado. A limitação do gráfico é que muitas vezes nossos gráficos vão para documentos estáticos como PDF e Word, inviabilizando o gif.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# bug no blogdown. precisa savar e depois inserir o gif
(ggplot(estados_focos) +
  geom_sf(aes(fill = focos, frame = ano), color = NA) +
  ggtitle(&amp;quot;Ano:&amp;quot;) +
  labs(fill = &amp;quot;Nº de focos de incêndios&amp;quot;) +
  scale_fill_viridis(label = unit_format(unit = &amp;quot;k&amp;quot;, scale = 1e-3)) +
  theme_bw() +
  theme(legend.position = &amp;quot;bottom&amp;quot;, legend.justification = &amp;quot;right&amp;quot;) +
  guides(fill = guide_colorbar(barwidth = 15, title.position = &amp;quot;top&amp;quot;))
  ) %&amp;gt;% 
  gganimate()&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/post/2017-07-08-graficos-com-dimensao-espacial-e-temporal_files/figure-html/focos-gif-.gif&#34; alt=&#34;focos-gif&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;focos-gif&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Caso tenha alguma dúvida ou sugestão sobre o post, fique à vontade para fazer um comentário ou me contactar por Email.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;devtools::session_info()
#&amp;gt;  setting  value                       
#&amp;gt;  version  R version 3.3.3 (2017-03-06)
#&amp;gt;  system   x86_64, mingw32             
#&amp;gt;  ui       RTerm                       
#&amp;gt;  language (EN)                        
#&amp;gt;  collate  Portuguese_Brazil.1252      
#&amp;gt;  tz       America/Sao_Paulo           
#&amp;gt;  date     2017-07-08                  
#&amp;gt; 
#&amp;gt;  package     * version    date       source                            
#&amp;gt;  animation   * 2.5        2017-03-30 CRAN (R 3.3.3)                    
#&amp;gt;  assertthat    0.2.0      2017-04-11 CRAN (R 3.3.3)                    
#&amp;gt;  backports     1.1.0      2017-05-22 CRAN (R 3.3.3)                    
#&amp;gt;  base        * 3.3.3      2017-03-06 local                             
#&amp;gt;  bindr         0.1        2016-11-13 CRAN (R 3.3.3)                    
#&amp;gt;  bindrcpp      0.2        2017-06-17 CRAN (R 3.3.3)                    
#&amp;gt;  blogdown      0.0.25     2017-03-23 Github (rstudio/blogdown@1c10d16) 
#&amp;gt;  bookdown      0.4        2017-05-20 CRAN (R 3.3.3)                    
#&amp;gt;  brmap       * 0.0.2      2017-07-07 local                             
#&amp;gt;  colorspace    1.3-2      2016-12-14 CRAN (R 3.3.2)                    
#&amp;gt;  curl          2.7        2017-06-26 CRAN (R 3.3.3)                    
#&amp;gt;  datasets    * 3.3.3      2017-03-06 local                             
#&amp;gt;  DBI           0.7        2017-06-18 CRAN (R 3.3.3)                    
#&amp;gt;  devtools      1.13.2     2017-06-02 CRAN (R 3.3.3)                    
#&amp;gt;  digest        0.6.12     2017-01-27 CRAN (R 3.3.2)                    
#&amp;gt;  dplyr       * 0.7.1      2017-06-22 CRAN (R 3.3.3)                    
#&amp;gt;  evaluate      0.10       2016-10-11 CRAN (R 3.3.3)                    
#&amp;gt;  geofacet    * 0.1.4      2017-06-20 CRAN (R 3.3.3)                    
#&amp;gt;  gganimate   * 0.1.0.9000 2017-05-24 Github (dgrtwo/gganimate@bf82002) 
#&amp;gt;  ggplot2     * 2.2.1.9000 2017-06-16 Github (tidyverse/ggplot2@398fc07)
#&amp;gt;  ggthemes    * 3.4.0      2017-02-19 CRAN (R 3.3.3)                    
#&amp;gt;  glue          1.1.1      2017-06-21 CRAN (R 3.3.3)                    
#&amp;gt;  graphics    * 3.3.3      2017-03-06 local                             
#&amp;gt;  grDevices   * 3.3.3      2017-03-06 local                             
#&amp;gt;  grid          3.3.3      2017-03-06 local                             
#&amp;gt;  gridExtra     2.2.1      2016-02-29 CRAN (R 3.3.3)                    
#&amp;gt;  gtable        0.2.0      2016-02-26 CRAN (R 3.3.2)                    
#&amp;gt;  highr         0.6        2016-05-09 CRAN (R 3.3.3)                    
#&amp;gt;  hms           0.3        2016-11-22 CRAN (R 3.3.2)                    
#&amp;gt;  htmltools     0.3.6      2017-04-28 CRAN (R 3.3.3)                    
#&amp;gt;  knitr       * 1.16       2017-05-18 CRAN (R 3.3.3)                    
#&amp;gt;  labeling      0.3        2014-08-23 CRAN (R 3.3.2)                    
#&amp;gt;  lazyeval      0.2.0      2016-06-12 CRAN (R 3.3.2)                    
#&amp;gt;  magrittr      1.5        2014-11-22 CRAN (R 3.3.2)                    
#&amp;gt;  memoise       1.1.0      2017-04-21 CRAN (R 3.3.3)                    
#&amp;gt;  methods       3.3.3      2017-03-06 local                             
#&amp;gt;  munsell       0.4.3      2016-02-13 CRAN (R 3.3.2)                    
#&amp;gt;  pacman      * 0.4.6      2017-05-14 CRAN (R 3.3.3)                    
#&amp;gt;  pkgconfig     2.0.1      2017-03-21 CRAN (R 3.3.3)                    
#&amp;gt;  plyr          1.8.4      2016-06-08 CRAN (R 3.3.2)                    
#&amp;gt;  R6            2.2.2      2017-06-17 CRAN (R 3.3.3)                    
#&amp;gt;  Rcpp          0.12.11    2017-05-22 CRAN (R 3.3.3)                    
#&amp;gt;  readr       * 1.1.1      2017-05-16 CRAN (R 3.3.3)                    
#&amp;gt;  rlang         0.1.1      2017-05-18 CRAN (R 3.3.3)                    
#&amp;gt;  rmarkdown     1.6        2017-06-15 CRAN (R 3.3.3)                    
#&amp;gt;  rprojroot     1.2        2017-01-16 CRAN (R 3.3.3)                    
#&amp;gt;  scales      * 0.4.1      2016-11-09 CRAN (R 3.3.2)                    
#&amp;gt;  sf          * 0.5-1      2017-06-23 CRAN (R 3.3.3)                    
#&amp;gt;  stats       * 3.3.3      2017-03-06 local                             
#&amp;gt;  stringi       1.1.5      2017-04-07 CRAN (R 3.3.3)                    
#&amp;gt;  stringr       1.2.0      2017-02-18 CRAN (R 3.3.2)                    
#&amp;gt;  tibble        1.3.3      2017-05-28 CRAN (R 3.3.3)                    
#&amp;gt;  tools         3.3.3      2017-03-06 local                             
#&amp;gt;  udunits2      0.13       2016-11-17 CRAN (R 3.3.2)                    
#&amp;gt;  units         0.4-5      2017-06-15 CRAN (R 3.3.3)                    
#&amp;gt;  utils       * 3.3.3      2017-03-06 local                             
#&amp;gt;  viridis     * 0.4.0      2017-03-27 CRAN (R 3.3.3)                    
#&amp;gt;  viridisLite * 0.2.0      2017-03-24 CRAN (R 3.3.3)                    
#&amp;gt;  withr         1.0.2      2016-06-20 CRAN (R 3.3.3)                    
#&amp;gt;  yaml          2.1.14     2016-11-12 CRAN (R 3.3.3)&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>