<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Ggrepel on Italo Cegatta</title>
    <link>/tags/ggrepel/</link>
    <description>Recent content in Ggrepel on Italo Cegatta</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>pt-br</language>
    <lastBuildDate>Sat, 24 Mar 2018 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="/tags/ggrepel/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Qual Estado tem mais pau-rodado?</title>
      <link>/qual-estado-tem-mais-pau-rodado/</link>
      <pubDate>Sat, 24 Mar 2018 00:00:00 +0000</pubDate>
      
      <guid>/qual-estado-tem-mais-pau-rodado/</guid>
      <description>Em Cuiabá, cidade que nasci e cresci, pau-rodado é um substantivo que define pessoas que nasceram em outro Estado mas moram em Cuiabá e ali construíram suas vidas. Aliás, Cuiabá sempre foi conhecida por ser uma Cidade super acolhedora e talvez por isso todos encaram o dito pau-rodado de uma forma engraçada e sem qualquer sentido pejorativo.
Muito bem, meu interesse com este post é analisar o comportamento dos fluxos migratórios entre Estados e assim encontrar os Estados que tem mais e menos pau-rodado em sua população residente.</description>
      <content:encoded>
        


&lt;p&gt;Em Cuiabá, cidade que nasci e cresci, &lt;em&gt;pau-rodado&lt;/em&gt; é um substantivo que define pessoas que nasceram em outro Estado mas moram em Cuiabá e ali construíram suas vidas. Aliás, Cuiabá sempre foi conhecida por ser uma Cidade super acolhedora e talvez por isso todos encaram o dito &lt;em&gt;pau-rodado&lt;/em&gt; de uma forma engraçada e sem qualquer sentido pejorativo.&lt;/p&gt;
&lt;p&gt;Muito bem, meu interesse com este post é analisar o comportamento dos fluxos migratórios entre Estados e assim encontrar os Estados que tem mais e menos &lt;em&gt;pau-rodado&lt;/em&gt; em sua população residente. Serei breve e não vamos abordar todos os Estados, mas se você tiver curiosidade poderá aproveitar o código para uma análise mais ampla.&lt;/p&gt;
&lt;p&gt;A motivação partiu de uma matéria do &lt;a href=&#34;https://www.nexojornal.com.br/grafico/2017/12/01/Fluxos-migrat%C3%B3rios-a-distribui%C3%A7%C3%A3o-da-popula%C3%A7%C3%A3o-de-cada-estado-pelo-pa%C3%ADs&#34;&gt;Nexo Jornal&lt;/a&gt; sobre este tema, porém ao nível estadual. Depois de algumas horas tentando decifrar o site do IBGE, cheguei na &lt;a href=&#34;https://sidra.ibge.gov.br/tabela/1852&#34;&gt;página&lt;/a&gt; que informa a população residente, por lugar de nascimento e unidade da federação.&lt;/p&gt;
&lt;p&gt;Então vamos começar a análise carregando os pacotes do R necessários para este post.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(&amp;quot;pacman&amp;quot;)) install.packages(&amp;quot;pacman&amp;quot;)
pacman::p_load(readr, dplyr, tidyr, forcats, sf, geosphere, brmap, ggplot2, ggrepel, geofacet)
pacman::p_load_gh(&amp;quot;italocegatta/brmap&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Os dados originais estão disponíveis neste &lt;a href=&#34;https://sidra.ibge.gov.br/tabela/1852&#34;&gt;link&lt;/a&gt;, fiz apenas adequações porque o IBGE insiste em mesclar células nas tabelas disponibilizadas. Já nesta tabela você consegue olhar para o Estado que você mora e analisar quanto dos residentes nasceram em outros Estados. Mas o objetivo é enxergar isso de forma gráfica para ampliar a percepção dos dados.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;base &amp;lt;- read_csv2(&amp;quot;https://raw.githubusercontent.com/italocegatta/italocegatta.github.io_source/master/content/dados/pnad_2015_migracao.csv&amp;quot;)

base&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 27 x 28
##    Estado Rondônia  Acre Amazonas Roraima  Pará Amapá Tocantins Maranhão
##    &amp;lt;chr&amp;gt;     &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;     &amp;lt;dbl&amp;gt;    &amp;lt;dbl&amp;gt;
##  1 Rondô~    57.4   1.84     1.9     0.08  0.7  NA        0.02      1.02
##  2 Acre       1.54 87.9      3.89    0.02  0.17 NA        0.02      0.11
##  3 Amazo~     0.46  1.6     87.6     0.23  5.36  0.13     0.06      0.87
##  4 Rorai~     0.65  0.24     5.16   55.6   6.54  0.04     0.570    19.0 
##  5 Pará       0.03  0.02     0.49    0.02 84.6   0.19     1.07      6.89
##  6 Amapá      0.1   0.03     0.2     0.17 20.8  72.7      0.1       3.65
##  7 Tocan~     0.07  0.07     0.02   NA     2.83  0.02    69.5       8.58
##  8 Maran~     0.03  0.01     0.05   NA     1.11  0.01     0.32     92.4 
##  9 Piauí      0.04  0.02     0.04    0.05  0.28 NA        0.11      3.97
## 10 Ceará      0.03  0.04     0.11   NA     0.22  0.01     0.03      0.35
## # ... with 17 more rows, and 19 more variables: Piauí &amp;lt;dbl&amp;gt;, Ceará &amp;lt;dbl&amp;gt;,
## #   `Rio Grande do Norte` &amp;lt;dbl&amp;gt;, Paraíba &amp;lt;dbl&amp;gt;, Pernambuco &amp;lt;dbl&amp;gt;,
## #   Alagoas &amp;lt;dbl&amp;gt;, Sergipe &amp;lt;dbl&amp;gt;, Bahia &amp;lt;dbl&amp;gt;, `Minas Gerais` &amp;lt;dbl&amp;gt;,
## #   `Espírito Santo` &amp;lt;dbl&amp;gt;, `Rio de Janeiro` &amp;lt;dbl&amp;gt;, `São Paulo` &amp;lt;dbl&amp;gt;,
## #   Paraná &amp;lt;dbl&amp;gt;, `Santa Catarina` &amp;lt;dbl&amp;gt;, `Rio Grande do Sul` &amp;lt;dbl&amp;gt;, `Mato
## #   Grosso do Sul` &amp;lt;dbl&amp;gt;, `Mato Grosso` &amp;lt;dbl&amp;gt;, Goiás &amp;lt;dbl&amp;gt;, `Distrito
## #   Federal` &amp;lt;dbl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Dados longitudinais como estes ajudam humanos a enxergar os valores de forma mais fácil, mas do ponto de vista de processamento de dados, não dá pra fazer muita coisa com os dados assim. Vamos organizá-los seguindo a filosofia do &lt;a href=&#34;https://italocegatta.github.io/o-conceito-tidy-data&#34;&gt;Tidy data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;A nova tabela nos informa a porcentagem da população residente (coluna ‘valor’) para cada Estado, subdividindo os valores por local de nascimento. E agora vai a primeira simplificação: foram selecionados apenas os 6 Estados de nascimento mais representativos para cada Estado de residência.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;df &amp;lt;- base %&amp;gt;% 
  gather(reside, valor, -Estado) %&amp;gt;%
  select(nasce = Estado, reside, valor) %&amp;gt;% 
  replace_na(list(valor = 0)) %&amp;gt;% 
  group_by(nasce) %&amp;gt;% 
  filter(row_number(-valor) &amp;lt;= 6) %&amp;gt;% 
  ungroup()

df&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 162 x 3
##    nasce    reside   valor
##    &amp;lt;chr&amp;gt;    &amp;lt;chr&amp;gt;    &amp;lt;dbl&amp;gt;
##  1 Rondônia Rondônia 57.4 
##  2 Acre     Rondônia  1.54
##  3 Amazonas Rondônia  0.46
##  4 Acre     Acre     87.9 
##  5 Amazonas Acre      1.6 
##  6 Acre     Amazonas  3.89
##  7 Amazonas Amazonas 87.6 
##  8 Roraima  Amazonas  5.16
##  9 Roraima  Roraima  55.6 
## 10 Amazonas Pará      5.36
## # ... with 152 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Vamos nos preparar para a segunda simplificação: selecionar os extremos em termos de população que nasceu e reside no mesmo Estado. Então, RS, CE e PE são os Estados que mais tem moradores nascidos dentro do próprio Estado, enquanto RO, RR e DF tem uma parcela maior de residentes nascidos em outros Estados.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;estados_interesse &amp;lt;- df %&amp;gt;%
  filter(reside == nasce) %&amp;gt;%
  filter(row_number(-valor) &amp;lt;= 3 | row_number(valor) &amp;lt;= 3) %&amp;gt;% 
  arrange(-valor) %&amp;gt;%
  pull(nasce)

estados_interesse&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Rio Grande do Sul&amp;quot; &amp;quot;Ceará&amp;quot;             &amp;quot;Pernambuco&amp;quot;       
## [4] &amp;quot;Rondônia&amp;quot;          &amp;quot;Roraima&amp;quot;           &amp;quot;Distrito Federal&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Preparando para o mapa, vamos pegar as coordenadas dos centroides de cada Estado.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;estado_cent &amp;lt;- brmap_estado_simples %&amp;gt;% 
  st_centroid() %&amp;gt;% 
  cbind(., st_coordinates(.)) %&amp;gt;% 
  st_set_geometry(NULL) %&amp;gt;% 
  select(estado = estado_nome, lon = X, lat = Y)

estado_cent&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                 estado       lon        lat
## 1             Rondônia -62.84198 -10.913179
## 2                 Acre -70.47331  -9.212856
## 3             Amazonas -64.65314  -4.154180
## 4              Roraima -61.39929   2.084236
## 5                 Pará -53.06412  -3.974753
## 6                Amapá -51.95593   1.443332
## 7            Tocantins -48.32923 -10.150295
## 8             Maranhão -45.27924  -5.060364
## 9                Piauí -42.96862  -7.387507
## 10               Ceará -39.61569  -5.093333
## 11 Rio Grande do Norte -36.67345  -5.839671
## 12             Paraíba -36.83252  -7.121067
## 13          Pernambuco -37.99844  -8.326032
## 14             Alagoas -36.62489  -9.513860
## 15             Sergipe -37.44398 -10.584509
## 16               Bahia -41.72093 -12.475028
## 17        Minas Gerais -44.67342 -18.456183
## 18      Espírito Santo -40.67104 -19.575096
## 19      Rio de Janeiro -42.65244 -22.188742
## 20           São Paulo -48.73408 -22.263477
## 21              Paraná -51.61670 -24.635890
## 22      Santa Catarina -50.47486 -27.247326
## 23   Rio Grande do Sul -53.32041 -29.705543
## 24  Mato Grosso do Sul -54.84563 -20.327333
## 25         Mato Grosso -55.91218 -12.949089
## 26               Goiás -49.62337 -16.042019
## 27    Distrito Federal -47.79736 -15.780667&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;E agora, o pulo do gato. Vamos criar as linhas que ligam os Estados entre si e em seguida adicionar à tabela que informa as relações de fluxo. Portanto, para cada relação entre Estado de nascimento/residência temos uma feição de linha e o valor que representa a porcentagem de residentes.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;coord &amp;lt;- df %&amp;gt;% 
  left_join(estado_cent, by = c(&amp;quot;nasce&amp;quot; = &amp;quot;estado&amp;quot;)) %&amp;gt;% 
  left_join(estado_cent, by = c(&amp;quot;reside&amp;quot; = &amp;quot;estado&amp;quot;)) %&amp;gt;%
  filter(nasce %in% estados_interesse)

linhas &amp;lt;- gcIntermediate(
  select(coord, lon.x, lat.x), 
  select(coord, lon.y, lat.y), 
  sp = TRUE, addStartEnd = TRUE
  ) %&amp;gt;% 
  st_as_sf()

fluxo_linha &amp;lt;- coord %&amp;gt;% 
  select(nasce, reside, valor) %&amp;gt;% 
  bind_cols(linhas) %&amp;gt;% 
  left_join(estado_cent, by = c(&amp;quot;reside&amp;quot; = &amp;quot;estado&amp;quot;)) %&amp;gt;% 
  mutate(nasce = fct_relevel(nasce, estados_interesse)) %&amp;gt;% 
  st_as_sf()

fluxo_linha&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Simple feature collection with 36 features and 5 fields
## geometry type:  LINESTRING
## dimension:      XY
## bbox:           xmin: -64.65314 ymin: -29.70554 xmax: -36.62489 ymax: 2.084236
## epsg (SRID):    4326
## proj4string:    +proj=longlat +ellps=WGS84 +no_defs
## # A tibble: 36 x 6
##    nasce    reside  valor   lon    lat                             geometry
##    &amp;lt;fct&amp;gt;    &amp;lt;chr&amp;gt;   &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;  &amp;lt;dbl&amp;gt;                    &amp;lt;LINESTRING [Â°]&amp;gt;
##  1 Rondônia Rondôn~ 57.4  -62.8 -10.9  (-62.84198 -10.91318, -62.84198 -10~
##  2 Roraima  Amazon~  5.16 -64.7  -4.15 (-61.39929 2.084236, -61.46309 1.96~
##  3 Roraima  Roraima 55.6  -61.4   2.08 (-61.39929 2.084236, -61.39929 2.08~
##  4 Roraima  Pará     6.54 -53.1  -3.97 (-61.39929 2.084236, -61.23585 1.96~
##  5 Roraima  Maranh~ 19.0  -45.3  -5.06 (-61.39929 2.084236, -61.08345 1.94~
##  6 Distrit~ Maranh~  4.42 -45.3  -5.06 (-47.79736 -15.78067, -47.74601 -15~
##  7 Ceará    Piauí    0.39 -43.0  -7.39 (-39.61569 -5.093333, -39.68117 -5.~
##  8 Distrit~ Piauí    5.08 -43.0  -7.39 (-47.79736 -15.78067, -47.69952 -15~
##  9 Roraima  Ceará    2.76 -39.6  -5.09 (-61.39929 2.084236, -60.9725 1.942~
## 10 Ceará    Ceará   95.8  -39.6  -5.09 (-39.61569 -5.093333, -39.61569 -5.~
## # ... with 26 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Para deixar o gráfico um pouco mais bonito, vamos dar cor ao valor que estamos estudando. Mas agora a feição será o polígono que representa o Estado de residentes.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fluxo_poligono &amp;lt;- brmap_estado_simples %&amp;gt;% 
  left_join(df, by =  c(&amp;quot;estado_nome&amp;quot; = &amp;quot;reside&amp;quot;)) %&amp;gt;% 
  rename(reside = estado_nome) %&amp;gt;% 
  filter(nasce %in% estados_interesse) %&amp;gt;% 
  mutate(nasce = fct_relevel(nasce, estados_interesse)) %&amp;gt;% 
  select(nasce, reside, valor)

fluxo_poligono&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Simple feature collection with 36 features and 3 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: -73.80156 ymin: -33.75077 xmax: -34.79288 ymax: 5.271841
## epsg (SRID):    4674
## proj4string:    +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs
## # A tibble: 36 x 4
##    nasce       reside  valor                                       geometry
##    &amp;lt;fct&amp;gt;       &amp;lt;chr&amp;gt;   &amp;lt;dbl&amp;gt;                                 &amp;lt;POLYGON [Â°]&amp;gt;
##  1 Rondônia    Rondôn~ 57.4  ((-61.58313 -8.798689, -61.5801 -8.802692, -6~
##  2 Roraima     Amazon~  5.16 ((-63.37209 2.211862, -63.35979 2.197102, -63~
##  3 Roraima     Roraima 55.6  ((-58.8955 1.227694, -58.89546 0.9047314, -58~
##  4 Roraima     Pará     6.54 ((-54.87225 2.433747, -54.87625 2.426694, -54~
##  5 Roraima     Maranh~ 19.0  ((-41.81411 -2.739309, -41.82457 -2.756218, -~
##  6 Distrito F~ Maranh~  4.42 ((-41.81411 -2.739309, -41.82457 -2.756218, -~
##  7 Ceará       Piauí    0.39 ((-41.32268 -2.92132, -41.32156 -2.935416, -4~
##  8 Distrito F~ Piauí    5.08 ((-41.32268 -2.92132, -41.32156 -2.935416, -4~
##  9 Roraima     Ceará    2.76 ((-37.25329 -4.831556, -37.44645 -4.880961, -~
## 10 Ceará       Ceará   95.8  ((-37.25329 -4.831556, -37.44645 -4.880961, -~
## # ... with 26 more rows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pronto, já temos todos os dados que fazer o gráfico de interesse. Lembrando que optamos por dar destaque a 6 Estados e para cada um deles, os 6 Estados de nascimento que mais representam a população de residentes. Sim, é um tanto complexo. Eu fiquei algumas horas para poder criar o código e entender o que estava processando.&lt;/p&gt;
&lt;p&gt;Como exemplo vamos interpretar as informações de Roraima: do total de residentes, 55.6% nasceram no próprio Estado de Roraima; 5.2%, 6.5% e 19% nasceram no Amazonas, Pará e Maranhão, respectivamente.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot() +
  geom_sf(data = brmap_estado_simples, color = &amp;quot;white&amp;quot;, fill = &amp;quot;grey80&amp;quot;, size = 0.3) +
  geom_sf(data = fluxo_poligono, aes(fill = valor), color = &amp;quot;white&amp;quot;, size = 0.3) +
  geom_sf(data = fluxo_linha, color = &amp;quot;cyan&amp;quot;, size = 0.3) +
  geom_label_repel(
    data = fluxo_linha,
    aes(lon, lat, label = round(valor, 1)),
    size = 3, segment.colour = NA
  ) +
  facet_wrap(~nasce) +
  labs(
    title = &amp;quot;População residente (% do total geral)&amp;quot;,
    subtitle = &amp;quot;PNAD/IBGE, 2015&amp;quot;,
    x = NULL, y = NULL
  ) +
  scale_fill_viridis_c(guide = FALSE) +
  coord_sf(datum = NA) +
  theme_void(16)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2018-03-24-qual-estado-tem-mais-pau-rodado_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;960&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Pontos interessantes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rondônia e Roraima retém uma proporção parecida da população dentro do próprio Estado, entretanto o pessoal que mora em Rondônia veio do Sul e Sudeste; ao passo que os moradores de Roraima vêm do AM, PA e MA.&lt;/li&gt;
&lt;li&gt;O Distrito Federal não me surpreendeu, grande parte de pessoas nasceram em GO, MG e BA.&lt;/li&gt;
&lt;li&gt;Um número expressivo de pessoas que nasceram em São Paulo e hoje moram no CE e PE… parece que o jogo virou, não é mesmo?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Caso tenha alguma dúvida ou sugestão sobre o post, fique à vontade para fazer um comentário ou me contatar por E-mail.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessioninfo::session_info(c(&amp;quot;readr&amp;quot;, &amp;quot;dplyr&amp;quot;, &amp;quot;ggplot2&amp;quot;, &amp;quot;tidyr&amp;quot;, &amp;quot;forcats&amp;quot;, &amp;quot;sf&amp;quot;, &amp;quot;geosphere&amp;quot;, &amp;quot;ggrepel&amp;quot;, &amp;quot;geofacet&amp;quot;, &amp;quot;brmap&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## - Session info ----------------------------------------------------------
##  setting  value                       
##  version  R version 3.5.1 (2018-07-02)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Portuguese_Brazil.1252      
##  ctype    Portuguese_Brazil.1252      
##  tz       America/Sao_Paulo           
##  date     2019-03-04                  
## 
## - Packages --------------------------------------------------------------
##  package       * version     date       lib
##  askpass         1.1         2019-01-13 [1]
##  assertthat      0.2.0       2017-04-11 [1]
##  backports       1.1.3       2018-12-14 [1]
##  BH              1.69.0-1    2019-01-07 [1]
##  brmap         * 0.1.0       2019-03-04 [1]
##  class           7.3-14      2015-08-30 [2]
##  classInt        0.3-1       2018-12-18 [1]
##  cli             1.0.1       2018-09-25 [1]
##  clipr           0.5.0       2019-01-11 [1]
##  colorspace      1.4-0       2019-01-13 [1]
##  crayon          1.3.4       2017-09-16 [1]
##  curl            3.3         2019-01-10 [1]
##  DBI             1.0.0       2018-05-02 [1]
##  digest          0.6.18      2018-10-10 [1]
##  dplyr         * 0.8.0.1     2019-02-15 [1]
##  e1071           1.7-0.1     2019-01-21 [1]
##  ellipsis        0.1.0       2019-02-19 [1]
##  fansi           0.4.0       2018-10-05 [1]
##  forcats       * 0.4.0       2019-02-17 [1]
##  geofacet      * 0.1.9       2018-03-29 [1]
##  geogrid         0.1.1       2018-12-11 [1]
##  geosphere     * 1.5-7       2017-11-05 [1]
##  ggplot2       * 3.1.0       2018-10-25 [1]
##  ggrepel       * 0.8.0       2018-05-09 [1]
##  glue            1.3.0       2018-07-17 [1]
##  gridExtra       2.3         2017-09-09 [1]
##  gtable          0.2.0       2016-02-26 [1]
##  hms             0.4.2       2018-03-10 [1]
##  httr            1.4.0       2018-12-11 [1]
##  imguR           1.0.3       2016-03-29 [1]
##  jpeg            0.1-8       2014-01-23 [1]
##  jsonlite        1.6         2018-12-07 [1]
##  labeling        0.3         2014-08-23 [1]
##  lattice         0.20-35     2017-03-25 [2]
##  lazyeval        0.2.1       2017-10-29 [1]
##  magrittr        1.5         2014-11-22 [1]
##  MASS            7.3-50      2018-04-30 [2]
##  Matrix          1.2-14      2018-04-13 [2]
##  mgcv            1.8-24      2018-06-23 [2]
##  mime            0.6         2018-10-05 [1]
##  munsell         0.5.0       2018-06-12 [1]
##  nlme            3.1-137     2018-04-07 [2]
##  openssl         1.2.1       2019-01-17 [1]
##  pillar          1.3.1       2018-12-15 [1]
##  pkgconfig       2.0.2       2018-08-16 [1]
##  plogr           0.2.0       2018-03-25 [1]
##  plyr            1.8.4       2016-06-08 [1]
##  png             0.1-7       2013-12-03 [1]
##  purrr           0.3.1       2019-03-03 [1]
##  R6              2.4.0       2019-02-14 [1]
##  RColorBrewer    1.1-2       2014-12-07 [1]
##  Rcpp            1.0.0       2018-11-07 [1]
##  RcppArmadillo   0.9.200.7.0 2019-01-17 [1]
##  readr         * 1.3.1       2018-12-21 [1]
##  reshape2        1.4.3       2017-12-11 [1]
##  rgeos           0.4-2       2018-11-08 [1]
##  rlang           0.3.1       2019-01-08 [1]
##  rnaturalearth   0.1.0       2017-03-21 [1]
##  scales          1.0.0       2018-08-09 [1]
##  sf            * 0.7-3       2019-02-21 [1]
##  sp              1.3-1       2018-06-05 [1]
##  stringi         1.3.1       2019-02-13 [1]
##  stringr         1.4.0       2019-02-10 [1]
##  sys             3.0         2019-02-25 [1]
##  tibble          2.0.1       2019-01-12 [1]
##  tidyr         * 0.8.3.9000  2019-03-04 [1]
##  tidyselect      0.2.5       2018-10-11 [1]
##  units           0.6-2       2018-12-05 [1]
##  utf8            1.1.4       2018-05-24 [1]
##  vctrs           0.1.0.9002  2019-03-04 [1]
##  viridisLite     0.3.0       2018-02-01 [1]
##  withr           2.1.2       2018-03-15 [1]
##  zeallot         0.1.0       2018-01-28 [1]
##  source                             
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  Github (italocegatta/brmap@648023a)
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  Github (tidyverse/tidyr@5ce48b5)   
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.1)                     
##  Github (r-lib/vctrs@5aa87f2)       
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
## 
## [1] C:/Users/Italo/Documents/R/win-library/3.5
## [2] C:/Program Files/R/R-3.5.1/library&lt;/code&gt;&lt;/pre&gt;

      </content:encoded>
    </item>
    
    <item>
      <title>Análise de componentes principais</title>
      <link>/analise-de-componentes-principais/</link>
      <pubDate>Mon, 01 Aug 2016 00:00:00 +0000</pubDate>
      
      <guid>/analise-de-componentes-principais/</guid>
      <description>Quando temos dados multivariados, a análise de componentes principais (PCA) é um recurso muito interessante e relativamente simples, em termos de conceito teórico e interpretação prática. Para exemplificar, vamos trabalhar com os dados climáticos de algumas cidades brasileiras. Os dados climáticos foram compilados a partir de estações automáticas do INMET.
No R, temos a facilidade de poder fazer o cálculo dos componentes principais e logo em seguida poder apresentá-los em gráficos elegantes e de fácil entendimento.</description>
      <content:encoded>
        


&lt;p&gt;Quando temos dados multivariados, a análise de componentes principais (PCA) é um recurso muito interessante e relativamente simples, em termos de conceito teórico e interpretação prática. Para exemplificar, vamos trabalhar com os dados climáticos de algumas cidades brasileiras. Os dados climáticos foram compilados a partir de estações automáticas do &lt;a href=&#34;http://www.inmet.gov.br/portal/index.php?r=estacoes/estacoesautomaticas&#34;&gt;INMET&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;No R, temos a facilidade de poder fazer o cálculo dos componentes principais e logo em seguida poder apresentá-los em gráficos elegantes e de fácil entendimento. O Objetivo deste post é apresentar uma rápida demonstração de como rodar um PCA e gerar os gráficos derivados.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (!require(&amp;quot;pacman&amp;quot;)) install.packages(&amp;quot;pacman&amp;quot;)
pacman::p_load(readr, dplyr, ggplot2, ggrepel)
pacman::p_load_gh(&amp;quot;vqv/ggbiplot&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dados &amp;lt;- read_csv2(
  &amp;quot;https://github.com/italocegatta/italocegatta.github.io_source/raw/master/content/dados/base_clima.csv&amp;quot;
)

print(dados, n=31)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 31 x 6
##    Cidade             Koppen  Tmed   PPT   ETP   DEF
##    &amp;lt;chr&amp;gt;              &amp;lt;chr&amp;gt;  &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt; &amp;lt;dbl&amp;gt;
##  1 Bom Despacho       Cwa     22.6  802. 1112. 238. 
##  2 Niquelandia        Aw      24.6  562. 1372. 656. 
##  3 Arapoti            Cfb     18.5 1367   670.  25.4
##  4 Rio Verde          Aw      23.3 1245. 1196. 425. 
##  5 Belo Oriente       Aw      22.6 1054. 1105. 125. 
##  6 Guanhaes           Cwa     20.6  818.  866  188. 
##  7 Eldorado do Sul    Cfa     20.6 1787.  859.  10.7
##  8 Sao Gabriel        Cfa     20.2 1783.  927.   2.8
##  9 Inhambupe          As      24.2  715. 1318. 607. 
## 10 Botucatu           Cfb     21.9 1013. 1030  184. 
## 11 Estrela do Sul     Cwa     23.4 1134. 1208. 206. 
## 12 Buri               Cfa     20.0 1404.  805    3.6
## 13 Inocencia          Am      24.5 1020. 1375. 389. 
## 14 Chapadao do Sul    Am      22.6 1027. 1098. 326. 
## 15 Aracruz            Aw      23.9  849. 1277. 336. 
## 16 Tres Lagoas        Aw      25.2  944. 1502. 538. 
## 17 Tres Marias        Aw      22.2  811. 1052. 405. 
## 18 Peixe              Aw      26.3 1208. 1630. 674. 
## 19 Mogi Guacu         Cwa     22.4  924. 1100. 210. 
## 20 Brejinho de Nazare Aw      25.9 1507. 1563. 496. 
## 21 Monte Dourado      Am      27.4 2529. 1821. 530. 
## 22 Otacilio Costa     Cfb     16.9 2092.  548.   0  
## 23 Telemaco Borba     Cfa     18.5 1367   670.  28  
## 24 Borebi             Cfa     22.1  948. 1058. 201. 
## 25 Coracao de Jesus   As      23.9  413. 1275. 744. 
## 26 Antonio Olinto     Cfb     17.7 1740.  616.   0  
## 27 Tres Barras        Cfb     17.3 1123.  581   16.5
## 28 Urbano Santos      Aw      27.0 1438. 1750. 935  
## 29 Eunapolis          Am      22.9 1419. 1128.  31.2
## 30 Itagimirim         Aw      25.2  491. 1460. 870. 
## 31 Bocaiuva           Aw      23.9  413. 1276. 642.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A análise de componentes principais nos mostra o quanto cada grupo de variáveis explicam a variabilidade total dados. No nosso caso, o primeiro componente responde por 72% da variabilidade e tem efeito quase que igual da temperatura (Tmed), evapotranspiração (ETP) e déficit hídrico (DEF). O segundo componente é majoritariamente o efeito da chuva (PPT). Juntos, os dois componentes explicam 95% dos dados.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;pca &amp;lt;- select(dados, Tmed:DEF) %&amp;gt;%
  princomp(cor = T)

summary(pca); loadings(pca)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Importance of components:
##                           Comp.1    Comp.2     Comp.3       Comp.4
## Standard deviation     1.7007490 0.9709348 0.40137904 0.0602784852
## Proportion of Variance 0.7231368 0.2356786 0.04027628 0.0009083739
## Cumulative Proportion  0.7231368 0.9588153 0.99909163 1.0000000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Loadings:
##      Comp.1 Comp.2 Comp.3 Comp.4
## Tmed  0.567  0.201  0.437  0.668
## PPT  -0.241  0.933 -0.251       
## ETP   0.561  0.284  0.261 -0.732
## DEF   0.553        -0.823       
## 
##                Comp.1 Comp.2 Comp.3 Comp.4
## SS loadings      1.00   1.00   1.00   1.00
## Proportion Var   0.25   0.25   0.25   0.25
## Cumulative Var   0.25   0.50   0.75   1.00&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A Figura &lt;a href=&#34;#fig:8-pca&#34;&gt;1&lt;/a&gt; ajuda-nos a visualizar a disposição das cidades em função dos dois principais componentes. Se analisarmos por quadrantes, podemos agrupar as cidades de clima semelhante e ainda verificar a relação com as variáveis de clima. As setas indicam o efeito positivo ou negativo da variável. Por exemplo, o quadrante Q4 é caracterizado por valores altos de chuva e praticamente nenhum deficit hídrico. No oposto, temos o Q2 com baixa precipitação e alto déficit hídrico.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggbiplot(pca) +
  geom_point() +
  geom_vline(xintercept = 0, size = 1.2, linetype = 6) +
  geom_hline(yintercept = 0, size = 1.2, linetype = 6) +
  geom_label_repel(aes(label = dados$Cidade), size = 3, nudge_x = .2) +
  annotate(
    &amp;quot;text&amp;quot;,
    x = c(-2, 2, 2, -2),
    y = c(2, 2, -2, -2), 
    label = paste0(&amp;quot;Q&amp;quot;, 1:4), size = 6
  ) +
  lims(x = c(-2,2), y = c(-2,2)) +
  theme_bw()&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:8-pca&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2016-08-01-analise-de-componentes-principais_files/figure-html/8-pca-1.svg&#34; alt=&#34;Representação gráfica dos componentes principais.&#34; width=&#34;768&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figura  1: Representação gráfica dos componentes principais.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Como também temos a informação do clima Koppen, podemos colorir o gráfico em função deste atributo (Figura &lt;a href=&#34;#fig:8-pca-koppen&#34;&gt;2&lt;/a&gt;).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggbiplot(pca) +
  geom_point(aes(color = dados$Koppen)) +
  geom_vline(xintercept = 0, size = 1.2, linetype = 6) +
  geom_hline(yintercept = 0, size = 1.2, linetype = 6) +
  geom_label_repel(
    aes(color = dados$Koppen, label = dados$Cidade),
    size = 3, nudge_x = .2, show.legend = F
  ) +
  lims(x = c(-2,2), y = c(-2,2)) +
  scale_color_brewer(&amp;quot;Clima Koppen&amp;quot;, palette = &amp;quot;Dark2&amp;quot;) +
  theme_bw()+
  theme(legend.position = &amp;quot;top&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:8-pca-koppen&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;/post/2016-08-01-analise-de-componentes-principais_files/figure-html/8-pca-koppen-1.svg&#34; alt=&#34;Representação gráfica dos componentes principais com classificação Koppen.&#34; width=&#34;768&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figura  2: Representação gráfica dos componentes principais com classificação Koppen.
&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Caso tenha alguma dúvida ou sugestão sobre o post, fique à vontade para fazer um comentário ou me contatar por E-mail.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessioninfo::session_info(c(&amp;quot;readr&amp;quot;, &amp;quot;dplyr&amp;quot;, &amp;quot;ggplot2&amp;quot;, &amp;quot;ggrepel&amp;quot;, &amp;quot;ggbiplot&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## - Session info ----------------------------------------------------------
##  setting  value                       
##  version  R version 3.5.1 (2018-07-02)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  Portuguese_Brazil.1252      
##  ctype    Portuguese_Brazil.1252      
##  tz       America/Sao_Paulo           
##  date     2018-12-31                  
## 
## - Packages --------------------------------------------------------------
##  package      * version  date       lib source                       
##  assertthat     0.2.0    2017-04-11 [1] CRAN (R 3.5.1)               
##  BH             1.66.0-1 2018-02-13 [1] CRAN (R 3.5.0)               
##  bindr          0.1.1    2018-03-13 [1] CRAN (R 3.5.1)               
##  bindrcpp       0.2.2    2018-03-29 [1] CRAN (R 3.5.1)               
##  cli            1.0.1    2018-09-25 [1] CRAN (R 3.5.1)               
##  clipr          0.4.1    2018-06-23 [1] CRAN (R 3.5.1)               
##  colorspace     1.3-2    2016-12-14 [1] CRAN (R 3.5.1)               
##  crayon         1.3.4    2017-09-16 [1] CRAN (R 3.5.1)               
##  digest         0.6.18   2018-10-10 [1] CRAN (R 3.5.1)               
##  dplyr        * 0.7.8    2018-11-10 [1] CRAN (R 3.5.1)               
##  fansi          0.4.0    2018-10-05 [1] CRAN (R 3.5.1)               
##  ggbiplot     * 0.55     2018-12-31 [1] Github (vqv/ggbiplot@7325e88)
##  ggplot2      * 3.1.0    2018-10-25 [1] CRAN (R 3.5.1)               
##  ggrepel      * 0.8.0    2018-05-09 [1] CRAN (R 3.5.1)               
##  glue           1.3.0    2018-07-17 [1] CRAN (R 3.5.1)               
##  gtable         0.2.0    2016-02-26 [1] CRAN (R 3.5.1)               
##  hms            0.4.2    2018-03-10 [1] CRAN (R 3.5.1)               
##  labeling       0.3      2014-08-23 [1] CRAN (R 3.5.0)               
##  lattice        0.20-35  2017-03-25 [2] CRAN (R 3.5.1)               
##  lazyeval       0.2.1    2017-10-29 [1] CRAN (R 3.5.1)               
##  magrittr       1.5      2014-11-22 [1] CRAN (R 3.5.1)               
##  MASS           7.3-50   2018-04-30 [2] CRAN (R 3.5.1)               
##  Matrix         1.2-14   2018-04-13 [2] CRAN (R 3.5.1)               
##  mgcv           1.8-24   2018-06-23 [2] CRAN (R 3.5.1)               
##  munsell        0.5.0    2018-06-12 [1] CRAN (R 3.5.1)               
##  nlme           3.1-137  2018-04-07 [2] CRAN (R 3.5.1)               
##  pillar         1.3.1    2018-12-15 [1] CRAN (R 3.5.2)               
##  pkgconfig      2.0.2    2018-08-16 [1] CRAN (R 3.5.1)               
##  plogr          0.2.0    2018-03-25 [1] CRAN (R 3.5.1)               
##  plyr         * 1.8.4    2016-06-08 [1] CRAN (R 3.5.1)               
##  purrr          0.2.5    2018-05-29 [1] CRAN (R 3.5.1)               
##  R6             2.3.0    2018-10-04 [1] CRAN (R 3.5.1)               
##  RColorBrewer   1.1-2    2014-12-07 [1] CRAN (R 3.5.0)               
##  Rcpp           1.0.0    2018-11-07 [1] CRAN (R 3.5.1)               
##  readr        * 1.2.1    2018-11-22 [1] CRAN (R 3.5.1)               
##  reshape2       1.4.3    2017-12-11 [1] CRAN (R 3.5.1)               
##  rlang          0.3.0.1  2018-10-25 [1] CRAN (R 3.5.1)               
##  scales       * 1.0.0    2018-08-09 [1] CRAN (R 3.5.1)               
##  stringi        1.2.4    2018-07-20 [1] CRAN (R 3.5.1)               
##  stringr        1.3.1    2018-05-10 [1] CRAN (R 3.5.1)               
##  tibble         1.4.2    2018-01-22 [1] CRAN (R 3.5.1)               
##  tidyselect     0.2.5    2018-10-11 [1] CRAN (R 3.5.1)               
##  utf8           1.1.4    2018-05-24 [1] CRAN (R 3.5.1)               
##  viridisLite    0.3.0    2018-02-01 [1] CRAN (R 3.5.1)               
##  withr          2.1.2    2018-03-15 [1] CRAN (R 3.5.1)               
## 
## [1] C:/Users/Italo/Documents/R/win-library/3.5
## [2] C:/Program Files/R/R-3.5.1/library&lt;/code&gt;&lt;/pre&gt;

      </content:encoded>
    </item>
    
  </channel>
</rss>
